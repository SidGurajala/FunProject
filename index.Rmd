---
title: "Covid 19 Maps : Sid Gurajala"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
source("./CovidMap.R")
knitr::opts_chunk$set(echo = TRUE)
```

## INTRO: 
This was a little project I did over this weekend using Kaggle data and the internet to try to find and map Covid 19 data in the US! I had a whole lot of free time. 

## DATA:
I got my data from kaggle: https://www.kaggle.com/fireballbyedimyrnmom/us-counties-covid-19-dataset.

This is a data set on kaggle sourced from the New York Times: here I've taken this data and pared it down to the state I'm interested in, Washington, and the most recent date this data was collected, May 7th 2020. 
```{r us_counties_covid}
library(dplyr)
washington_df <- us_counties_covid %>% 
                  filter(state == "Washington" & date == "2020-05-07") %>% 
                  mutate(county = tolower(county)) %>% 
                  group_by(county) %>% 
                  summarize(
                    cases = cases,
                    deaths = deaths)
head(washington_df)
```

The next step includes taking data from the maps library, which has to be downloaded externally, of the latitude and longitude of Washington state counties. Then we have to join the data frame outputed by the map_data function with our pared down washington_df data frame. A bit of a warning here: the washington_df doesn't contain data from all counties, but wash_counties has coordinates for all of them. Rather than remove the NA values, I've decided to keep them as an indication of that data not being included by the New York Times. 

```{r washington_df} 
library(maps)
wash_counties <- map_data("county", "Washington") %>% 
                    rename(county = subregion)
wash_counties_deaths_cases <- left_join(wash_counties, washington_df)
head(wash_counties_deaths_cases)
```

This output is what we'll use to create the map of cases that is the objective of this exercise. On to plotting!

## MAKING A MAP:
Here we want to start out by taking our joined wash_counties_deaths_cases data frame and inputting the latitude and longitude coordinates to make an outline of the plot we want to use. The fill here is cases, but we could also use deaths as you'll see in an example towards the end of this document. You'll need to install the ggplot2 package seperately. 
``` {r wash_counties_deaths_cases} 
library(ggplot2)
wash0 <- ggplot(data = wash_counties_deaths_cases,
             mapping = aes(x = long, y = lat, group = group, fill = cases))
```

The output of this, wash0, isn't actually the map of washington state. Here we've set the stage for ggplot2, and we have to provide directions as to what actual map projection, in this case the albers projection, we want ggplot2 to implement our cases, latitude, and longitude data with. The output of the next few lines of code will give you a heatmap of cases in Washington state. The grey areas are places in which the values are NA, or the data set has on information on cases/deaths for these counties. 
``` {r wash0}
wash1 <- wash0 + geom_polygon(color = "ivory", size = 0.3) +
  coord_map(projection = "albers", lat0 = 45.55, lat1 = 49)
wash1
```

This is a cool output! However, we have a few things left. I found this little no_axes trick on stack overflow; it removes things like the axis labels and the latitude and longitude labels to produce a cleaner map! I'm going to pair this with our wash1 output to create a map without the longitude and latitude labels, and then add a few labels and odds and ends, like changing the color scheme, to make a pretty map! 
``` {r wash1}
no_axes <- theme(
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.title = element_blank()
)

wash2 <- wash1 + scale_fill_gradient(low = "white", high = "#F21717") +
  labs(title = "Washington Covid Cases by County") + no_axes

wash_covid_map <- wash2 + labs(fill = "Cases")
```

Here our output is a map of washington covid cases by county! 
```{r wash_covid_map}
wash_covid_map
```

## CALIFORNIA, AN INTEGRATED EXAMPLE: 

Here I'm going to show a cool example I made using California, but without any of the intermediate steps! The code is more or less the same, so check it out below! 
```{r}
library(ggplot2)
library(maps)
library(dplyr)
california_df <- us_counties_covid %>% 
  filter(state == "California" & date == "2020-05-07") %>% 
  mutate(county = tolower(county)) %>% 
  group_by(county) %>% 
  summarize(
    cases = cases,
    deaths = deaths)

cali_counties <- map_data("county", "California") %>% 
  rename(county = subregion)

cali_counties_deaths_cases <- left_join(cali_counties, california_df)

cali0 <- ggplot(data = cali_counties_deaths_cases,
             mapping = aes(x = long, y = lat, group = group, fill = deaths))

cali_covid_map <- cali0 + geom_polygon(color = "ivory", size = 0.3) +
  coord_map(projection = "albers", lat0 = 32, lat1 = 42) +
  labs(title = "California Covid Deaths by County") +
  scale_fill_gradient(low = "white", high = "#660033") +
  no_axes +
  labs(fill = "Deaths")
```

Now let's take a look at our map! 
```{r cali_covid_map}
cali_covid_map